---
name: nextjs_setup
description: Sets up Next.js 14+ project with App Router, Feature-Sliced Design structure, and production-ready configuration.
model: haiku
---

# Next.js Project Setup Skill

Sets up a Next.js 14+ project with App Router and FSD structure.

## Prerequisites

- Node.js 18+ installed
- npm or pnpm
- Git initialized

## Workflow

### 1. Create Project

```bash
# Create Next.js project
npx create-next-app@latest ${PROJECT_NAME} \
  --typescript \
  --tailwind \
  --eslint \
  --app \
  --src-dir \
  --import-alias "@/*"

cd ${PROJECT_NAME}
```

### 2. Install Additional Dependencies

```bash
# State Management & Data Fetching
npm install @tanstack/react-query zustand

# Forms & Validation
npm install react-hook-form @hookform/resolvers zod

# UI Utilities
npm install clsx tailwind-merge

# Dev Dependencies
npm install -D @testing-library/react @testing-library/jest-dom
npm install -D vitest @vitejs/plugin-react jsdom
npm install -D prettier
```

### 3. Create FSD Structure (Adapted for App Router)

```bash
# App Router handles routing in src/app
# FSD layers are structured separately in src/

mkdir -p src/{widgets,features,entities,shared}
mkdir -p src/shared/{ui,lib,api,config,types}
mkdir -p src/shared/ui/{button,input,card}
```

### 4. Directory Structure

```
src/
├── app/                    # Next.js App Router (Pages)
│   ├── (auth)/            # Route groups
│   │   ├── login/
│   │   └── register/
│   ├── dashboard/
│   ├── api/               # API Routes
│   ├── layout.tsx
│   ├── page.tsx
│   └── globals.css
├── widgets/               # Composite UI blocks
├── features/              # User interactions
├── entities/              # Business entities
└── shared/                # Shared utilities
    ├── ui/
    ├── lib/
    ├── api/
    └── types/
```

### 5. Shared Library

**src/shared/lib/cn.ts:**
```typescript
import { type ClassValue, clsx } from 'clsx';
import { twMerge } from 'tailwind-merge';

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs));
}
```

**src/shared/api/client.ts:**
```typescript
const BASE_URL = process.env.NEXT_PUBLIC_API_URL || '';

interface FetchOptions extends RequestInit {
  params?: Record<string, string>;
}

export async function fetcher<T>(
  endpoint: string,
  options: FetchOptions = {}
): Promise<T> {
  const { params, ...init } = options;

  const url = new URL(endpoint, BASE_URL);
  if (params) {
    Object.entries(params).forEach(([key, value]) => {
      url.searchParams.append(key, value);
    });
  }

  const response = await fetch(url.toString(), {
    ...init,
    headers: {
      'Content-Type': 'application/json',
      ...init.headers,
    },
  });

  if (!response.ok) {
    throw new Error(`HTTP error! status: ${response.status}`);
  }

  return response.json();
}
```

### 6. Providers Setup

**src/app/providers.tsx:**
```typescript
'use client';

import { QueryClient, QueryClientProvider } from '@tanstack/react-query';
import { ReactQueryDevtools } from '@tanstack/react-query-devtools';
import { useState, ReactNode } from 'react';

interface ProvidersProps {
  children: ReactNode;
}

export function Providers({ children }: ProvidersProps) {
  const [queryClient] = useState(
    () =>
      new QueryClient({
        defaultOptions: {
          queries: {
            staleTime: 60 * 1000,
            refetchOnWindowFocus: false,
          },
        },
      })
  );

  return (
    <QueryClientProvider client={queryClient}>
      {children}
      <ReactQueryDevtools initialIsOpen={false} />
    </QueryClientProvider>
  );
}
```

**src/app/layout.tsx:**
```typescript
import type { Metadata } from 'next';
import { Inter } from 'next/font/google';
import { Providers } from './providers';
import './globals.css';

const inter = Inter({ subsets: ['latin'] });

export const metadata: Metadata = {
  title: '${PROJECT_NAME}',
  description: 'Generated by create next app',
};

export default function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <html lang="en">
      <body className={inter.className}>
        <Providers>{children}</Providers>
      </body>
    </html>
  );
}
```

### 7. Sample Page

**src/app/page.tsx:**
```typescript
export default function HomePage() {
  return (
    <main className="min-h-screen flex items-center justify-center">
      <div className="text-center">
        <h1 className="text-4xl font-bold text-gray-900">
          Welcome to ${PROJECT_NAME}
        </h1>
        <p className="mt-4 text-gray-600">
          Built with Next.js 14 and Feature-Sliced Design
        </p>
      </div>
    </main>
  );
}
```

### 8. Shared UI Component

**src/shared/ui/button/index.tsx:**
```typescript
import { ButtonHTMLAttributes, forwardRef } from 'react';
import { cn } from '@/shared/lib/cn';

interface ButtonProps extends ButtonHTMLAttributes<HTMLButtonElement> {
  variant?: 'primary' | 'secondary' | 'outline';
  size?: 'sm' | 'md' | 'lg';
}

export const Button = forwardRef<HTMLButtonElement, ButtonProps>(
  ({ className, variant = 'primary', size = 'md', ...props }, ref) => {
    return (
      <button
        ref={ref}
        className={cn(
          'inline-flex items-center justify-center rounded-md font-medium transition-colors',
          'focus-visible:outline-none focus-visible:ring-2',
          {
            'bg-blue-600 text-white hover:bg-blue-700': variant === 'primary',
            'bg-gray-100 text-gray-900 hover:bg-gray-200': variant === 'secondary',
            'border border-gray-300 bg-transparent hover:bg-gray-50': variant === 'outline',
          },
          {
            'h-8 px-3 text-sm': size === 'sm',
            'h-10 px-4 text-base': size === 'md',
            'h-12 px-6 text-lg': size === 'lg',
          },
          className
        )}
        {...props}
      />
    );
  }
);

Button.displayName = 'Button';
```

### 9. Vitest Configuration

**vitest.config.ts:**
```typescript
import { defineConfig } from 'vitest/config';
import react from '@vitejs/plugin-react';
import path from 'path';

export default defineConfig({
  plugins: [react()],
  test: {
    environment: 'jsdom',
    globals: true,
    setupFiles: './src/test/setup.ts',
  },
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src'),
    },
  },
});
```

### 10. Extend tsconfig.json

```json
{
  "compilerOptions": {
    "paths": {
      "@/*": ["./src/*"],
      "@widgets/*": ["./src/widgets/*"],
      "@features/*": ["./src/features/*"],
      "@entities/*": ["./src/entities/*"],
      "@shared/*": ["./src/shared/*"]
    }
  }
}
```

### 11. Package.json Scripts

```json
{
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "next lint",
    "test": "vitest",
    "test:coverage": "vitest run --coverage"
  }
}
```

## Generated Structure

```
${PROJECT_NAME}/
├── public/
├── src/
│   ├── app/
│   │   ├── api/
│   │   ├── layout.tsx
│   │   ├── page.tsx
│   │   ├── providers.tsx
│   │   └── globals.css
│   ├── widgets/
│   ├── features/
│   ├── entities/
│   ├── shared/
│   │   ├── ui/
│   │   │   └── button/
│   │   ├── lib/
│   │   │   └── cn.ts
│   │   ├── api/
│   │   │   └── client.ts
│   │   └── types/
│   └── test/
│       └── setup.ts
├── package.json
├── tsconfig.json
├── next.config.js
├── tailwind.config.ts
└── vitest.config.ts
```

## Verification Checklist

- [ ] `npm run dev` runs
- [ ] `npm run build` succeeds
- [ ] `npm test` passes
- [ ] Path aliases work
- [ ] Providers work correctly

## Summary Report

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Next.js Project Setup Complete
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Project: ${PROJECT_NAME}
Next.js: 14+
TypeScript: 5+
Tailwind CSS

- App Router configured
- FSD structure created
- TanStack Query configured
- Shared UI components

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```
